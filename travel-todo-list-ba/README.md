# Travel Todo List Backend Architecture

æœ¬é¡¹ç›®çš„åç«¯é‡‡ç”¨äº†ç»å…¸çš„åˆ†å±‚æ¶æ„ï¼ˆLayered Architectureï¼‰è®¾è®¡ï¼Œæ—¨åœ¨å®ç°é«˜å†…èšã€ä½è€¦åˆçš„ä»£ç ç»“æ„ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚

## ğŸ—ï¸ æ¶æ„åˆ†å±‚è®¾è®¡

é¡¹ç›®ä»£ç ä¸»è¦åˆ’åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæ ¸å¿ƒå±‚çº§ï¼Œæ•°æ®æµå‘é€šå¸¸ä¸ºï¼š`Request` -> `Route` -> `Controller` -> `Service` -> `Model` -> `Database`ã€‚

### 1. è·¯ç”±å±‚ (Routes)
- **èŒè´£**ï¼šè´Ÿè´£å®šä¹‰ API çš„ URL è·¯å¾„ï¼Œå°† HTTP è¯·æ±‚åˆ†å‘ç»™å¯¹åº”çš„æ§åˆ¶å™¨ã€‚
- **ä½ç½®**ï¼š`src/routes`
- **ç‰¹ç‚¹**ï¼š
  - ä¸åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚
  - è´Ÿè´£å‚æ•°çš„åŸºæœ¬æ ¡éªŒï¼ˆå¦‚ Joi æ ¡éªŒï¼‰ã€‚
  - é…ç½®ä¸­é—´ä»¶ï¼ˆå¦‚è®¤è¯å®ˆå«ï¼‰ã€‚

### 2. æ§åˆ¶å™¨å±‚ (Controllers)
- **èŒè´£**ï¼šä½œä¸º HTTP è¯·æ±‚çš„å…¥å£ï¼Œè´Ÿè´£è§£æè¯·æ±‚å‚æ•°ï¼Œè°ƒç”¨æœåŠ¡å±‚å¤„ç†ä¸šåŠ¡ï¼Œå¹¶æ ¼å¼åŒ–å“åº”ç»“æœã€‚
- **ä½ç½®**ï¼š`src/controllers`
- **ç‰¹ç‚¹**ï¼š
  - **ä¸ç›´æ¥æ“ä½œæ•°æ®åº“**ã€‚
  - å¤„ç† HTTP çŠ¶æ€ç ï¼ˆ200, 201, 400 ç­‰ï¼‰ã€‚
  - æ•è·å¹¶ç»Ÿä¸€å¤„ç†é”™è¯¯ï¼ˆé€šè¿‡ `catchAsync`ï¼‰ã€‚

### 3. æœåŠ¡å±‚ (Services)
- **èŒè´£**ï¼šåŒ…å«æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œæ˜¯ç³»ç»Ÿæœ€å¤æ‚çš„éƒ¨åˆ†ã€‚
- **ä½ç½®**ï¼š`src/services`
- **ç‰¹ç‚¹**ï¼š
  - å¤ç”¨æ€§å¼ºï¼Œå¯ä»¥è¢«å¤šä¸ª Controller è°ƒç”¨ã€‚
  - è´Ÿè´£å¤æ‚çš„ä¸šåŠ¡è®¡ç®—ã€æ•°æ®ç»„è£…ã€ç¬¬ä¸‰æ–¹æœåŠ¡è°ƒç”¨ã€‚
  - **ç›´æ¥ä¸ Model å±‚äº¤äº’**ã€‚
  - æŠ›å‡ºä¸šåŠ¡å±‚é¢çš„é”™è¯¯ï¼ˆå¦‚ `ApiError`ï¼‰ã€‚

### 4. æ¨¡å‹å±‚ (Models)
- **èŒè´£**ï¼šå®šä¹‰æ•°æ®ç»“æ„å’Œæ•°æ®åº“æ“ä½œã€‚
- **ä½ç½®**ï¼š`src/models`
- **ç‰¹ç‚¹**ï¼š
  - ä½¿ç”¨ Sequelize å®šä¹‰æ•°æ® Schemaã€‚
  - åŒ…å«æ•°æ®éªŒè¯é€»è¾‘ï¼ˆå¦‚å­—æ®µç±»å‹ã€å¿…å¡«é¡¹ï¼‰ã€‚
  - å®šä¹‰æ•°æ®å…³è”ï¼ˆHasOne, HasManyï¼‰ã€‚
  - åŒ…å«é’©å­å‡½æ•°ï¼ˆHooksï¼‰ï¼Œå¦‚å¯†ç åŠ å¯†ã€‚

---

## ğŸ§© ç›®å½•ç»“æ„è¯´æ˜

```
travel-todo-list-ba/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶ï¼ˆæ•°æ®åº“é…ç½®ã€Passportç­–ç•¥ç­‰ï¼‰
â”‚   â”œâ”€â”€ controllers/        # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â””â”€â”€ auth.controller.js
â”‚   â”œâ”€â”€ middlewares/        # ä¸­é—´ä»¶ï¼ˆå…¨å±€é”™è¯¯å¤„ç†ã€è®¤è¯ã€æ—¥å¿—ï¼‰
â”‚   â”‚   â””â”€â”€ error.js
â”‚   â”œâ”€â”€ models/             # æ¨¡å‹å±‚ (Sequelize Models)
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â””â”€â”€ user.js
â”‚   â”œâ”€â”€ routes/             # è·¯ç”±å±‚
â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚       â”œâ”€â”€ index.js
â”‚   â”‚       â””â”€â”€ auth.route.js
â”‚   â”œâ”€â”€ services/           # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ auth.service.js
â”‚   â”‚   â””â”€â”€ token.service.js
â”‚   â”œâ”€â”€ utils/              # é€šç”¨å·¥å…·ç±» (ApiError, catchAsync)
â”‚   â”œâ”€â”€ app.js              # Express åº”ç”¨å®ä¾‹é…ç½®
â”‚   â””â”€â”€ server.js           # æœåŠ¡å¯åŠ¨å…¥å£
```

## ğŸš€ æ‹†åˆ†æœåŠ¡çš„æœ€ä½³å®è·µ

åœ¨å¼€å‘æ–°åŠŸèƒ½æ—¶ï¼Œè¯·éµå¾ªä»¥ä¸‹æ‹†åˆ†åŸåˆ™ï¼š

1.  **å®šä¹‰æ•°æ®æ¨¡å‹**ï¼š
    - åœ¨ `src/models` ä¸­åˆ›å»ºæ–°çš„ Model æ–‡ä»¶ï¼ˆå¦‚ `task.js`ï¼‰ã€‚
    - åœ¨ `src/models/index.js` ä¸­æ³¨å†Œå¹¶å»ºç«‹å…³è”ã€‚

2.  **ç¼–å†™ä¸šåŠ¡é€»è¾‘**ï¼š
    - åœ¨ `src/services` ä¸­åˆ›å»ºå¯¹åº”çš„ Serviceï¼ˆå¦‚ `task.service.js`ï¼‰ã€‚
    - å®ç° CRUD æ–¹æ³•ï¼ˆ`createTask`, `getTasks`, ...ï¼‰ã€‚
    - ç¡®ä¿æ‰€æœ‰æ•°æ®åº“æ“ä½œéƒ½åœ¨ Service å±‚å®Œæˆã€‚

3.  **åˆ›å»ºæ§åˆ¶å™¨**ï¼š
    - åœ¨ `src/controllers` ä¸­åˆ›å»º Controllerï¼ˆå¦‚ `task.controller.js`ï¼‰ã€‚
    - å¼•å…¥ Serviceï¼Œå¤„ç†è¯·æ±‚å‚æ•°ï¼ˆ`req.body`, `req.query`ï¼‰ã€‚
    - è°ƒç”¨ Service æ–¹æ³•ï¼Œè¿”å› JSON å“åº”ã€‚

4.  **é…ç½®è·¯ç”±**ï¼š
    - åœ¨ `src/routes/v1` ä¸­åˆ›å»º Route æ–‡ä»¶ï¼ˆå¦‚ `task.route.js`ï¼‰ã€‚
    - å®šä¹‰è·¯å¾„ï¼ˆå¦‚ `POST /tasks`ï¼‰å¹¶æŒ‡å‘ Controller æ–¹æ³•ã€‚
    - åœ¨ `src/routes/v1/index.js` ä¸­æ³¨å†Œæ–°è·¯ç”±ã€‚

## ğŸ’¡ ç¤ºä¾‹æµç¨‹ï¼šç”¨æˆ·æ³¨å†Œ

1.  **Route**: `POST /auth/register` æ¥æ”¶è¯·æ±‚ -> è½¬å‘ç»™ `authController.register`ã€‚
2.  **Controller**: `authController` æå– `email`, `password` -> è°ƒç”¨ `authService.createUser`ã€‚
3.  **Service**: `authService` æ£€æŸ¥é‚®ç®±æ˜¯å¦é‡å¤ -> è°ƒç”¨ `User.create`ã€‚
4.  **Model**: `User` æ¨¡å‹è§¦å‘ `beforeCreate` é’©å­ -> å¯¹å¯†ç è¿›è¡Œ Hash åŠ å¯† -> å­˜å…¥æ•°æ®åº“ã€‚
5.  **Response**: æ•°æ®åº“è¿”å› User å¯¹è±¡ -> Service è¿”å› User -> Controller ç”Ÿæˆ Token å¹¶è¿”å› `{ user, tokens }`ã€‚
